<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Proposal Generator with Finish Photos - Foundry Cabinets Co</title>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Configuration System -->
    <script src="config.js"></script>
    
    <style>
        :root {
            --primary-gold: #D4B062;
            --light-gold: #F4E4A1;
            --cream: #FBF8F0;
            --warm-white: #FEFCF7;
            --charcoal: #2C2C2C;
            --dark-gray: #4A4A4A;
            --light-gray: #E8E8E8;
            --success: #2E7D4A;
            --warning: #C5801A;
            --danger: #C5281A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--warm-white) 0%, var(--cream) 100%);
            color: var(--charcoal);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-gold), #C5A055);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Company Logo Section */
        .logo-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-left: 6px solid var(--primary-gold);
        }

        .company-logo-img {
            max-width: 100%;
            max-height: 80px;
            object-fit: contain;
            border-radius: 8px;
            cursor: pointer;
            display: none;
        }

        .logo-upload-area {
            border: 2px dashed var(--primary-gold);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .logo-upload-area:hover {
            background: var(--cream);
            border-color: #C5A055;
        }

        /* Finish Options Section */
        .finish-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .finish-option-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-left: 6px solid var(--primary-gold);
            transition: transform 0.3s ease;
        }

        .finish-option-card:hover {
            transform: translateY(-5px);
        }

        .finish-title {
            font-size: 1.5rem;
            color: var(--charcoal);
            margin-bottom: 1rem;
            font-weight: 600;
            text-align: center;
        }

        /* Photo Upload Zone */
        .photo-upload-zone {
            border: 2px dashed var(--light-gray);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .photo-upload-zone:hover,
        .photo-upload-zone.dragover {
            border-color: var(--primary-gold);
            background: var(--cream);
        }

        .upload-text {
            font-size: 1rem;
            color: var(--dark-gray);
            margin-bottom: 0.5rem;
        }

        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .photo-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--light-gray);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-preview:hover {
            border-color: var(--danger);
            opacity: 0.7;
        }

        /* Buttons */
        .btn {
            background: var(--primary-gold);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background: #C5A055;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #A5201A;
        }

        /* Actions Section */
        .actions-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .photo-upload-zone {
                padding: 1.5rem;
                font-size: 0.9rem;
            }
            
            .photo-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .photo-preview {
                width: 80px;
                height: 80px;
            }
            
            .company-logo-img {
                max-height: 60px;
            }

            .finish-options {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden File Inputs */
        .hidden-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèóÔ∏è Enhanced Proposal Generator</h1>
        <p>Professional Cabinet Proposals with Finish Photos</p>
    </div>

    <div class="container">
        <!-- Company Logo Section -->
        <div class="logo-section">
            <h2>üè¢ Company Logo</h2>
            <div class="logo-upload-area" onclick="document.getElementById('logo-upload').click()">
                <div class="upload-text">üìÅ Click to upload your company logo</div>
                <img id="company-logo-img" class="company-logo-img" style="display: none;">
            </div>
            <input type="file" id="logo-upload" class="hidden-input" accept="image/*" onchange="handleLogoUpload(event)">
        </div>

        <!-- Finish Options Section -->
        <div class="finish-options">
            <!-- Painted Finish -->
            <div class="finish-option-card">
                <h3 class="finish-title">üé® Painted Finish</h3>
                <div class="photo-upload-zone" 
                     ondrop="handlePhotoDrop(event, 'painted')" 
                     ondragover="allowDrop(event)"
                     onclick="document.getElementById('photos-painted').click()">
                    <div class="upload-text">üì∑ Drag photos here or click to upload</div>
                    <div class="photo-preview-grid" id="preview-painted"></div>
                </div>
                <input type="file" id="photos-painted" class="hidden-input" multiple accept="image/*" onchange="handlePhotoUpload(event, 'painted')">
            </div>

            <!-- Stained Finish -->
            <div class="finish-option-card">
                <h3 class="finish-title">ü™µ Stained Finish</h3>
                <div class="photo-upload-zone" 
                     ondrop="handlePhotoDrop(event, 'stained')" 
                     ondragover="allowDrop(event)"
                     onclick="document.getElementById('photos-stained').click()">
                    <div class="upload-text">üì∑ Drag photos here or click to upload</div>
                    <div class="photo-preview-grid" id="preview-stained"></div>
                </div>
                <input type="file" id="photos-stained" class="hidden-input" multiple accept="image/*" onchange="handlePhotoUpload(event, 'stained')">
            </div>

            <!-- Premium Finish -->
            <div class="finish-option-card">
                <h3 class="finish-title">‚ú® Premium Finish</h3>
                <div class="photo-upload-zone" 
                     ondrop="handlePhotoDrop(event, 'premium')" 
                     ondragover="allowDrop(event)"
                     onclick="document.getElementById('photos-premium').click()">
                    <div class="upload-text">üì∑ Drag photos here or click to upload</div>
                    <div class="photo-preview-grid" id="preview-premium"></div>
                </div>
                <input type="file" id="photos-premium" class="hidden-input" multiple accept="image/*" onchange="handlePhotoUpload(event, 'premium')">
            </div>

            <!-- Luxury Finish -->
            <div class="finish-option-card">
                <h3 class="finish-title">üíé Luxury Finish</h3>
                <div class="photo-upload-zone" 
                     ondrop="handlePhotoDrop(event, 'luxury')" 
                     ondragover="allowDrop(event)"
                     onclick="document.getElementById('photos-luxury').click()">
                    <div class="upload-text">üì∑ Drag photos here or click to upload</div>
                    <div class="photo-preview-grid" id="preview-luxury"></div>
                </div>
                <input type="file" id="photos-luxury" class="hidden-input" multiple accept="image/*" onchange="handlePhotoUpload(event, 'luxury')">
            </div>
        </div>

        <!-- Actions Section -->
        <div class="actions-section">
            <h2>üìÑ Generate Proposal</h2>
            <p>Create a professional PDF proposal with your uploaded logo and finish photos</p>
            <br>
            <button class="btn" onclick="generateEnhancedPDF()">üìã Generate PDF with Photos</button>
            <button class="btn btn-danger" onclick="clearAllPhotos()" style="margin-left: 1rem;">üóëÔ∏è Clear All Photos</button>
        </div>
    </div>

    <script>
        // Photo storage and management
        const photoStorage = {
            painted: [],
            stained: [],
            premium: [],
            luxury: []
        };

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéâ Enhanced Proposal Generator with Finish Photos initialized!');
            loadPhotosFromStorage();
            loadLogoFromStorage();
        });

        // TODO: Fix logo upload functionality with file reader and localStorage
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update logo display
                    const logoImg = document.getElementById('company-logo-img');
                    logoImg.src = e.target.result;
                    logoImg.style.display = 'block';
                    
                    // Store in localStorage for persistence
                    localStorage.setItem('companyLogo', e.target.result);
                    
                    // Update all option cards with logo
                    updateOptionCardLogos(e.target.result);
                    
                    console.log('‚úÖ Logo uploaded and stored successfully');
                };
                reader.readAsDataURL(file);
            } else {
                alert('Please select a valid image file.');
            }
        }

        function loadLogoFromStorage() {
            const storedLogo = localStorage.getItem('companyLogo');
            if (storedLogo) {
                const logoImg = document.getElementById('company-logo-img');
                logoImg.src = storedLogo;
                logoImg.style.display = 'block';
                updateOptionCardLogos(storedLogo);
            }
        }

        function updateOptionCardLogos(logoSrc) {
            // This function could be used to add logos to option cards if needed
            console.log('Logo updated for option cards');
        }

        // TODO: Implement drag and drop photo upload for finish options
        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handlePhotoDrop(event, finishType) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            const files = Array.from(event.dataTransfer.files);
            processPhotoFiles(files, finishType);
        }

        function handlePhotoUpload(event, finishType) {
            const files = Array.from(event.target.files);
            processPhotoFiles(files, finishType);
        }

        // TODO: Add photo preview grid with delete functionality
        function processPhotoFiles(files, finishType) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photoStorage[finishType].push(e.target.result);
                        updatePhotoPreview(finishType);
                        savePhotosToStorage();
                        console.log(`‚úÖ Photo added to ${finishType} finish`);
                    };
                    reader.readAsDataURL(file);
                } else {
                    console.warn(`Skipped non-image file: ${file.name}`);
                }
            });
        }

        function updatePhotoPreview(finishType) {
            const previewContainer = document.getElementById(`preview-${finishType}`);
            previewContainer.innerHTML = '';
            
            photoStorage[finishType].forEach((photo, index) => {
                const img = document.createElement('img');
                img.src = photo;
                img.className = 'photo-preview';
                img.title = 'Click to remove this photo';
                img.onclick = () => removePhoto(finishType, index);
                previewContainer.appendChild(img);
            });
        }

        function removePhoto(finishType, index) {
            if (confirm('Remove this photo?')) {
                photoStorage[finishType].splice(index, 1);
                updatePhotoPreview(finishType);
                savePhotosToStorage();
                console.log(`Photo removed from ${finishType} finish`);
            }
        }

        // TODO: Implement photo storage persistence with localStorage
        function savePhotosToStorage() {
            localStorage.setItem('finishPhotos', JSON.stringify(photoStorage));
        }

        function loadPhotosFromStorage() {
            const stored = localStorage.getItem('finishPhotos');
            if (stored) {
                Object.assign(photoStorage, JSON.parse(stored));
                Object.keys(photoStorage).forEach(updatePhotoPreview);
                console.log('‚úÖ Photos loaded from storage');
            }
        }

        function getStoredPhotos(finishType) {
            return photoStorage[finishType] || [];
        }

        function clearAllPhotos() {
            if (confirm('Are you sure you want to clear all photos? This cannot be undone.')) {
                Object.keys(photoStorage).forEach(key => {
                    photoStorage[key] = [];
                    updatePhotoPreview(key);
                });
                localStorage.removeItem('finishPhotos');
                console.log('üóëÔ∏è All photos cleared');
            }
        }

        // TODO: Update PDF generation to include uploaded logo and photos
        async function generateEnhancedPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                // PDF Header
                pdf.setFontSize(20);
                pdf.text('Professional Cabinet Proposal', 20, 20);
                
                let yPosition = 30;
                
                // Add company logo to PDF header
                const logoData = localStorage.getItem('companyLogo');
                if (logoData) {
                    try {
                        pdf.addImage(logoData, 'JPEG', 20, yPosition, 50, 25);
                        yPosition += 35;
                    } catch (error) {
                        console.warn('Could not add logo to PDF:', error);
                    }
                }
                
                // Add company information
                pdf.setFontSize(16);
                pdf.text('Foundry Cabinets Co', 20, yPosition);
                yPosition += 10;
                pdf.setFontSize(12);
                pdf.text('Professional Cabinet Solutions', 20, yPosition);
                yPosition += 20;
                
                // Add finish option photos
                const finishTypes = ['painted', 'stained', 'premium', 'luxury'];
                const finishNames = {
                    painted: 'Painted Finish',
                    stained: 'Stained Finish', 
                    premium: 'Premium Finish',
                    luxury: 'Luxury Finish'
                };
                
                for (const type of finishTypes) {
                    const photos = getStoredPhotos(type);
                    if (photos.length > 0) {
                        // Check if we need a new page
                        if (yPosition > 200) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        
                        pdf.setFontSize(14);
                        pdf.text(`${finishNames[type]} Examples:`, 20, yPosition);
                        yPosition += 10;
                        
                        // Add up to 3 photos per finish type
                        let photoCount = 0;
                        for (let i = 0; i < Math.min(3, photos.length); i++) {
                            try {
                                const xPos = 20 + (photoCount * 60);
                                pdf.addImage(photos[i], 'JPEG', xPos, yPosition, 50, 40);
                                photoCount++;
                            } catch (error) {
                                console.warn(`Could not add photo ${i} for ${type}:`, error);
                            }
                        }
                        yPosition += 50;
                        
                        if (photos.length > 3) {
                            pdf.setFontSize(10);
                            pdf.text(`(${photos.length - 3} additional photos available)`, 20, yPosition);
                            yPosition += 10;
                        }
                    }
                }
                
                // Add footer
                const pageCount = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(10);
                    pdf.text(`Generated on ${new Date().toLocaleDateString()} - Page ${i} of ${pageCount}`, 20, 280);
                }
                
                // Save the PDF
                pdf.save('cabinet-proposal-with-photos.pdf');
                console.log('‚úÖ Enhanced PDF generated successfully');
                
            } catch (error) {
                console.error('‚ùå Error generating PDF:', error);
                alert('There was an error generating the PDF. Please check the console for details.');
            }
        }

        // Add drag event listeners to prevent default browser behavior
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>