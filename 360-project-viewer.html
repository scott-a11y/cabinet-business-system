<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">360° Virtual Tours - Foundry Cabinets Co</title>
    
    <!-- 🛡️ BULLETPROOF CONFIGURATION SYSTEM -->
    <script src="config.js"></script>
    
    <!-- Three.js CDN for 3D panoramic viewing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        :root {
            --primary-gold: #D4B062;
            --light-gold: #F4E4A1;
            --cream: #FBF8F0;
            --warm-white: #FEFCF7;
            --charcoal: #2C2C2C;
            --dark-gray: #4A4A4A;
            --light-gray: #E8E8E8;
            --success: #2E7D4A;
            --warning: #C5801A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--warm-white) 0%, var(--cream) 100%);
            color: var(--charcoal);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav-header {
            background: white;
            border-bottom: 1px solid var(--light-gray);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 0 2rem;
            flex-wrap: wrap;
        }

        .nav-item {
            color: var(--dark-gray);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .nav-item:hover {
            background: var(--light-gold);
            color: var(--charcoal);
        }

        .nav-item.active {
            background: var(--primary-gold);
            color: white;
        }

        /* Header Section */
        .tour-header {
            background: linear-gradient(135deg, var(--primary-gold), #C5A055);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .header-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .vr-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        /* Project Selection */
        .project-selection {
            background: white;
            padding: 2rem 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .selection-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .selection-title {
            text-align: center;
            font-size: 1.5rem;
            color: var(--charcoal);
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .project-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .project-card {
            background: var(--cream);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--primary-gold);
        }

        .project-card.active {
            background: var(--primary-gold);
            color: white;
            border-color: var(--primary-gold);
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* 360 Viewer Container */
        .viewer-container {
            background: var(--charcoal);
            position: relative;
            min-height: 60vh;
        }

        .viewer-canvas {
            width: 100%;
            height: 60vh;
            display: block;
            cursor: grab;
        }

        .viewer-canvas:active {
            cursor: grabbing;
        }

        .viewer-canvas.fullscreen {
            height: 100vh;
        }

        /* Loading State */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--charcoal);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
        }

        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid var(--primary-gold);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Interactive Hotspots */
        .hotspot {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--primary-gold);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            z-index: 20;
            animation: pulse 2s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .hotspot:hover {
            transform: translate(-50%, -50%) scale(1.2);
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0 rgba(212, 176, 98, 0.7); }
            50% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 0 10px rgba(212, 176, 98, 0); }
        }

        /* Hotspot Info Panel */
        .hotspot-info {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            max-width: 300px;
            z-index: 30;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .hotspot-info.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 0.5rem;
        }

        .info-description {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .info-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .spec-tag {
            background: var(--light-gold);
            color: var(--charcoal);
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
        }

        .info-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--dark-gray);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-close:hover {
            background: var(--light-gray);
        }

        /* Control Panel */
        .control-panel {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            border-radius: 25px;
            padding: 1rem 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            backdrop-filter: blur(10px);
            z-index: 25;
        }

        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn:hover {
            background: var(--primary-gold);
        }

        .control-btn.active {
            background: var(--primary-gold);
        }

        /* Scene Navigation */
        .scene-nav {
            position: absolute;
            top: 2rem;
            left: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 25;
        }

        .scene-btn {
            background: rgba(0,0,0,0.7);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .scene-btn:hover {
            border-color: var(--primary-gold);
            background: rgba(212, 176, 98, 0.3);
        }

        .scene-btn.active {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
        }

        /* Instructions */
        .instructions {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            max-width: 200px;
            backdrop-filter: blur(10px);
            z-index: 25;
        }

        .instructions-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .instructions-list {
            list-style: none;
            line-height: 1.4;
        }

        .instructions-list li {
            margin-bottom: 0.25rem;
            opacity: 0.9;
        }

        /* Project Info Section */
        .project-info-section {
            background: white;
            padding: 3rem 0;
        }

        .info-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .info-card {
            background: var(--cream);
            padding: 2rem;
            border-radius: 12px;
            border-left: 4px solid var(--primary-gold);
        }

        .info-card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 1rem;
        }

        .info-card-content {
            color: var(--dark-gray);
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }

            .nav-item {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }

            .header-title {
                font-size: 2rem;
            }

            .viewer-canvas {
                height: 50vh;
            }

            .control-panel {
                bottom: 1rem;
                padding: 0.75rem 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .control-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .scene-nav {
                top: 1rem;
                left: 1rem;
            }

            .instructions {
                display: none; /* Hide on mobile to avoid clutter */
            }

            .hotspot-info {
                max-width: 250px;
                padding: 1rem;
            }

            .project-cards {
                grid-template-columns: 1fr;
            }
        }

        /* VR Mode Styles */
        .vr-mode .viewer-canvas {
            height: 100vh;
        }

        .vr-mode .control-panel,
        .vr-mode .scene-nav,
        .vr-mode .instructions {
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-header">
        <div class="nav-container">
            <a href="index.html" class="nav-item">🏠 Business Hub</a>
            <a href="admin-dashboard.html" class="nav-item">📊 Admin Dashboard</a>
            <a href="client-proposal.html" class="nav-item">📋 Client Proposals</a>
            <a href="pdf-proposal-generator.html" class="nav-item">📄 PDF Generator</a>
            <a href="client-portal.html" class="nav-item">👥 Client Portal</a>
            <a href="multi-photo-gallery.html" class="nav-item">📸 Photo Gallery</a>
            <a href="before-after-showcase.html" class="nav-item">🔄 Before/After</a>
            <a href="360-project-viewer.html" class="nav-item active">🌐 Virtual Tours</a>
            <a href="interactive-estimate-calculator.html" class="nav-item">🧮 Calculator</a>
            <a href="comprehensive-demo.html" class="nav-item">🎭 Full Demo</a>
        </div>
    </nav>

    <!-- Header Section -->
    <header class="tour-header">
        <div class="header-content">
            <h1 class="header-title">360° Virtual Tours</h1>
            <p class="header-subtitle">Immerse yourself in our completed projects with cutting-edge virtual reality technology</p>
            <div class="vr-badge">🥽 VR Ready Experience</div>
        </div>
    </header>

    <!-- Project Selection -->
    <section class="project-selection">
        <div class="selection-container">
            <h2 class="selection-title">Choose a Project to Explore</h2>
            <div class="project-cards" id="project-cards">
                <!-- Project cards will be generated here -->
            </div>
        </div>
    </section>

    <!-- 360 Viewer -->
    <section class="viewer-container" id="viewer-container">
        <canvas class="viewer-canvas" id="viewer-canvas"></canvas>
        
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
            <div style="text-align: center;">
                <div class="loading-spinner"></div>
                <div>Loading Virtual Tour...</div>
            </div>
        </div>

        <!-- Scene Navigation -->
        <div class="scene-nav" id="scene-nav">
            <!-- Scene buttons will be generated here -->
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <div class="instructions-title">How to Navigate</div>
            <ul class="instructions-list">
                <li>🖱️ Drag to look around</li>
                <li>📱 Touch & swipe on mobile</li>
                <li>⚪ Click hotspots for details</li>
                <li>🎯 Use scene buttons to move</li>
                <li>⛶ Fullscreen for VR mode</li>
            </ul>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <button class="control-btn" id="auto-rotate-btn">
                🔄 Auto Rotate
            </button>
            <button class="control-btn" id="fullscreen-btn">
                ⛶ Fullscreen
            </button>
            <button class="control-btn" id="reset-view-btn">
                🎯 Reset View
            </button>
            <button class="control-btn" id="info-toggle-btn">
                ℹ️ Show Info
            </button>
        </div>

        <!-- Hotspot Info Panel -->
        <div class="hotspot-info" id="hotspot-info">
            <button class="info-close" id="info-close">×</button>
            <div class="info-title" id="info-title"></div>
            <div class="info-description" id="info-description"></div>
            <div class="info-specs" id="info-specs"></div>
        </div>
    </section>

    <!-- Project Information -->
    <section class="project-info-section">
        <div class="info-container">
            <div class="info-grid" id="project-details">
                <!-- Project details will be generated here -->
            </div>
        </div>
    </section>

    <script>
        // Project data with panoramic tours
        const virtualTourProjects = [
            {
                id: 'modern-kitchen-360',
                title: 'Modern Kitchen Transformation',
                icon: '🍳',
                description: 'Award-winning contemporary kitchen design',
                scenes: [
                    {
                        id: 'kitchen-main',
                        name: 'Main Kitchen',
                        panorama: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=2048&h=1024&fit=crop&crop=center&auto=format',
                        hotspots: [
                            {
                                id: 'island',
                                x: 0.3, y: 0.4,
                                title: 'Custom Kitchen Island',
                                description: 'Waterfall quartz countertop with integrated storage and seating for 4.',
                                specs: ['Quartz Countertop', '6ft Island', 'Hidden Storage', 'LED Lighting']
                            },
                            {
                                id: 'cabinets',
                                x: 0.7, y: 0.5,
                                title: 'Upper Cabinets',
                                description: 'Soft-close European hinges with crown molding and LED under-cabinet lighting.',
                                specs: ['Soft-Close Hardware', 'Crown Molding', 'LED Strips', 'Premium Finish']
                            }
                        ]
                    },
                    {
                        id: 'kitchen-pantry',
                        name: 'Walk-in Pantry',
                        panorama: 'https://images.unsplash.com/photo-1556909275-abb17c5e5d2e?w=2048&h=1024&fit=crop&crop=center&auto=format',
                        hotspots: [
                            {
                                id: 'pantry-storage',
                                x: 0.5, y: 0.3,
                                title: 'Pantry Organization',
                                description: 'Custom shelving system with pull-out drawers and spice racks.',
                                specs: ['Pull-out Drawers', 'Adjustable Shelves', 'Spice Racks', 'Wine Storage']
                            }
                        ]
                    }
                ],
                details: {
                    timeline: '6 weeks',
                    investment: '$58,000',
                    features: ['Custom Island', 'Soft-Close Hardware', 'LED Lighting', 'Crown Molding'],
                    client: 'The Johnson Family',
                    location: 'Portland, OR'
                }
            },
            {
                id: 'luxury-bathroom-360',
                title: 'Luxury Master Bathroom',
                icon: '🛁',
                description: 'Spa-inspired bathroom retreat',
                scenes: [
                    {
                        id: 'bathroom-main',
                        name: 'Master Bath',
                        panorama: 'https://images.unsplash.com/photo-1620626011761-996317b8d101?w=2048&h=1024&fit=crop&crop=center&auto=format',
                        hotspots: [
                            {
                                id: 'vanity',
                                x: 0.4, y: 0.6,
                                title: 'Double Vanity',
                                description: 'Custom double vanity with quartz countertops and premium fixtures.',
                                specs: ['Double Sinks', 'Quartz Counters', 'Soft-Close Drawers', 'LED Mirrors']
                            },
                            {
                                id: 'storage',
                                x: 0.8, y: 0.4,
                                title: 'Linen Tower',
                                description: 'Floor-to-ceiling linen storage with adjustable shelving.',
                                specs: ['Floor to Ceiling', 'Adjustable Shelves', 'Soft-Close Doors', 'Interior Lighting']
                            }
                        ]
                    }
                ],
                details: {
                    timeline: '3 weeks',
                    investment: '$24,500',
                    features: ['Double Vanity', 'Linen Tower', 'Premium Hardware', 'LED Lighting'],
                    client: 'The Martinez Family',
                    location: 'Lake Oswego, OR'
                }
            },
            {
                id: 'home-office-360',
                title: 'Custom Home Office',
                icon: '💼',
                description: 'Professional workspace with built-in storage',
                scenes: [
                    {
                        id: 'office-main',
                        name: 'Home Office',
                        panorama: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=2048&h=1024&fit=crop&crop=center&auto=format',
                        hotspots: [
                            {
                                id: 'desk',
                                x: 0.5, y: 0.7,
                                title: 'Built-in Desk',
                                description: 'Custom desk with integrated cable management and storage drawers.',
                                specs: ['Built-in Desk', 'Cable Management', 'File Drawers', 'Task Lighting']
                            },
                            {
                                id: 'bookshelf',
                                x: 0.2, y: 0.3,
                                title: 'Floor-to-Ceiling Shelving',
                                description: 'Custom bookshelf system with adjustable shelves and display areas.',
                                specs: ['Adjustable Shelves', 'Display Areas', 'LED Lighting', 'Premium Finish']
                            }
                        ]
                    }
                ],
                details: {
                    timeline: '4 weeks',
                    investment: '$28,000',
                    features: ['Built-in Desk', 'Custom Shelving', 'Cable Management', 'Task Lighting'],
                    client: 'Thompson Residence',
                    location: 'Beaverton, OR'
                }
            }
        ];

        // 360 Tour Viewer Class
        class VirtualTourViewer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.sphere = null;
                this.controls = null;
                this.currentProject = null;
                this.currentScene = null;
                this.hotspots = [];
                this.autoRotate = false;
                this.isFullscreen = false;
                
                this.initViewer();
                this.initProjects();
                this.initControls();
                
                // Apply configuration
                setTimeout(() => this.applyConfiguration(), 100);
            }
            
            initViewer() {
                // Three.js setup
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                
                const canvas = document.getElementById('viewer-canvas');
                this.renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
                this.updateRendererSize();
                
                // Create sphere for panoramic image
                const geometry = new THREE.SphereGeometry(500, 60, 40);
                geometry.scale(-1, 1, 1); // Invert for inside view
                
                this.material = new THREE.MeshBasicMaterial();
                this.sphere = new THREE.Mesh(geometry, this.material);
                this.scene.add(this.sphere);
                
                // Set initial camera position
                this.camera.position.set(0, 0, 0);
                
                // Initialize mouse/touch controls
                this.initMouseControls();
                this.initTouchControls();
                
                // Start render loop
                this.animate();
                
                // Handle window resize
                window.addEventListener('resize', () => this.handleResize());
            }
            
            initMouseControls() {
                const canvas = document.getElementById('viewer-canvas');
                let isMouseDown = false;
                let mouseX = 0, mouseY = 0;
                let lat = 0, lon = 0;
                let phi = 0, theta = 0;
                
                canvas.addEventListener('mousedown', (e) => {
                    isMouseDown = true;
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                });
                
                canvas.addEventListener('mousemove', (e) => {
                    if (!isMouseDown) return;
                    
                    const deltaX = e.clientX - mouseX;
                    const deltaY = e.clientY - mouseY;
                    
                    lon += deltaX * 0.1;
                    lat -= deltaY * 0.1;
                    
                    lat = Math.max(-85, Math.min(85, lat));
                    
                    phi = THREE.MathUtils.degToRad(90 - lat);
                    theta = THREE.MathUtils.degToRad(lon);
                    
                    this.camera.target = new THREE.Vector3();
                    this.camera.target.x = 500 * Math.sin(phi) * Math.cos(theta);
                    this.camera.target.y = 500 * Math.cos(phi);
                    this.camera.target.z = 500 * Math.sin(phi) * Math.sin(theta);
                    
                    this.camera.lookAt(this.camera.target);
                    
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                });
                
                canvas.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });
                
                // Prevent context menu
                canvas.addEventListener('contextmenu', (e) => e.preventDefault());
            }
            
            initTouchControls() {
                const canvas = document.getElementById('viewer-canvas');
                let isTouching = false;
                let touchX = 0, touchY = 0;
                let lat = 0, lon = 0;
                let phi = 0, theta = 0;
                
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    isTouching = true;
                    touchX = touch.clientX;
                    touchY = touch.clientY;
                });
                
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (!isTouching) return;
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - touchX;
                    const deltaY = touch.clientY - touchY;
                    
                    lon += deltaX * 0.1;
                    lat -= deltaY * 0.1;
                    
                    lat = Math.max(-85, Math.min(85, lat));
                    
                    phi = THREE.MathUtils.degToRad(90 - lat);
                    theta = THREE.MathUtils.degToRad(lon);
                    
                    this.camera.target = new THREE.Vector3();
                    this.camera.target.x = 500 * Math.sin(phi) * Math.cos(theta);
                    this.camera.target.y = 500 * Math.cos(phi);
                    this.camera.target.z = 500 * Math.sin(phi) * Math.sin(theta);
                    
                    this.camera.lookAt(this.camera.target);
                    
                    touchX = touch.clientX;
                    touchY = touch.clientY;
                });
                
                canvas.addEventListener('touchend', () => {
                    isTouching = false;
                });
            }
            
            initProjects() {
                const container = document.getElementById('project-cards');
                
                container.innerHTML = virtualTourProjects.map((project, index) => `
                    <div class="project-card ${index === 0 ? 'active' : ''}" 
                         data-project-id="${project.id}"
                         onclick="tourViewer.selectProject('${project.id}')">
                        <span class="card-icon">${project.icon}</span>
                        <div class="card-title">${project.title}</div>
                        <div class="card-description">${project.description}</div>
                    </div>
                `).join('');
                
                // Load first project by default
                this.selectProject(virtualTourProjects[0].id);
            }
            
            selectProject(projectId) {
                this.currentProject = virtualTourProjects.find(p => p.id === projectId);
                if (!this.currentProject) return;
                
                // Update active card
                document.querySelectorAll('.project-card').forEach(card => {
                    card.classList.remove('active');
                    if (card.dataset.projectId === projectId) {
                        card.classList.add('active');
                    }
                });
                
                // Load first scene
                this.loadScene(this.currentProject.scenes[0].id);
                this.updateProjectDetails();
                this.updateSceneNavigation();
            }
            
            loadScene(sceneId) {
                if (!this.currentProject) return;
                
                const scene = this.currentProject.scenes.find(s => s.id === sceneId);
                if (!scene) return;
                
                this.currentScene = scene;
                this.showLoading(true);
                
                // Load panoramic image
                const loader = new THREE.TextureLoader();
                loader.load(
                    scene.panorama,
                    (texture) => {
                        this.material.map = texture;
                        this.material.needsUpdate = true;
                        this.showLoading(false);
                        this.createHotspots();
                    },
                    (progress) => {
                        // Loading progress
                    },
                    (error) => {
                        console.error('Error loading panorama:', error);
                        this.showLoading(false);
                    }
                );
                
                // Update active scene button
                document.querySelectorAll('.scene-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.sceneId === sceneId) {
                        btn.classList.add('active');
                    }
                });
            }
            
            createHotspots() {
                // Clear existing hotspots
                this.clearHotspots();
                
                if (!this.currentScene || !this.currentScene.hotspots) return;
                
                const canvas = document.getElementById('viewer-canvas');
                const rect = canvas.getBoundingClientRect();
                
                this.currentScene.hotspots.forEach((hotspotData, index) => {
                    const hotspot = document.createElement('div');
                    hotspot.className = 'hotspot';
                    hotspot.textContent = (index + 1).toString();
                    hotspot.style.left = `${hotspotData.x * 100}%`;
                    hotspot.style.top = `${hotspotData.y * 100}%`;
                    
                    hotspot.addEventListener('click', () => {
                        this.showHotspotInfo(hotspotData, hotspot);
                    });
                    
                    document.getElementById('viewer-container').appendChild(hotspot);
                    this.hotspots.push(hotspot);
                });
            }
            
            showHotspotInfo(hotspotData, hotspotElement) {
                const infoPanel = document.getElementById('hotspot-info');
                const rect = hotspotElement.getBoundingClientRect();
                const containerRect = document.getElementById('viewer-container').getBoundingClientRect();
                
                document.getElementById('info-title').textContent = hotspotData.title;
                document.getElementById('info-description').textContent = hotspotData.description;
                
                const specsContainer = document.getElementById('info-specs');
                specsContainer.innerHTML = hotspotData.specs.map(spec => 
                    `<span class="spec-tag">${spec}</span>`
                ).join('');
                
                // Position info panel
                let left = rect.left - containerRect.left;
                let top = rect.bottom - containerRect.top + 10;
                
                // Adjust position if it would go off screen
                if (left + 300 > containerRect.width) {
                    left = rect.left - containerRect.left - 300;
                }
                
                infoPanel.style.left = `${left}px`;
                infoPanel.style.top = `${top}px`;
                infoPanel.classList.add('visible');
            }
            
            hideHotspotInfo() {
                document.getElementById('hotspot-info').classList.remove('visible');
            }
            
            clearHotspots() {
                this.hotspots.forEach(hotspot => hotspot.remove());
                this.hotspots = [];
            }
            
            updateSceneNavigation() {
                if (!this.currentProject) return;
                
                const container = document.getElementById('scene-nav');
                container.innerHTML = this.currentProject.scenes.map((scene, index) => `
                    <button class="scene-btn ${index === 0 ? 'active' : ''}" 
                            data-scene-id="${scene.id}"
                            onclick="tourViewer.loadScene('${scene.id}')">
                        ${scene.name}
                    </button>
                `).join('');
            }
            
            updateProjectDetails() {
                if (!this.currentProject) return;
                
                const container = document.getElementById('project-details');
                const details = this.currentProject.details;
                
                container.innerHTML = `
                    <div class="info-card">
                        <div class="info-card-title">Project Overview</div>
                        <div class="info-card-content">
                            <p><strong>Client:</strong> ${details.client}</p>
                            <p><strong>Location:</strong> ${details.location}</p>
                            <p><strong>Timeline:</strong> ${details.timeline}</p>
                            <p><strong>Investment:</strong> ${details.investment}</p>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">Key Features</div>
                        <div class="info-card-content">
                            <ul>${details.features.map(feature => `<li>${feature}</li>`).join('')}</ul>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">Get Similar Project</div>
                        <div class="info-card-content">
                            <p>Interested in a similar project? Our expert team can create a custom solution for your space.</p>
                            <button class="control-btn" style="margin-top: 1rem;" 
                                    onclick="requestSimilarProject('${this.currentProject.id}')">
                                Request Quote
                            </button>
                        </div>
                    </div>
                `;
            }
            
            initControls() {
                // Auto rotate
                document.getElementById('auto-rotate-btn').addEventListener('click', () => {
                    this.toggleAutoRotate();
                });
                
                // Fullscreen
                document.getElementById('fullscreen-btn').addEventListener('click', () => {
                    this.toggleFullscreen();
                });
                
                // Reset view
                document.getElementById('reset-view-btn').addEventListener('click', () => {
                    this.resetView();
                });
                
                // Info toggle
                document.getElementById('info-toggle-btn').addEventListener('click', () => {
                    this.toggleInstructions();
                });
                
                // Close info panel
                document.getElementById('info-close').addEventListener('click', () => {
                    this.hideHotspotInfo();
                });
            }
            
            toggleAutoRotate() {
                this.autoRotate = !this.autoRotate;
                const btn = document.getElementById('auto-rotate-btn');
                btn.classList.toggle('active', this.autoRotate);
                btn.textContent = this.autoRotate ? '⏸ Stop Rotate' : '🔄 Auto Rotate';
            }
            
            toggleFullscreen() {
                const canvas = document.getElementById('viewer-canvas');
                const container = document.getElementById('viewer-container');
                
                if (!this.isFullscreen) {
                    if (container.requestFullscreen) {
                        container.requestFullscreen();
                    } else if (container.webkitRequestFullscreen) {
                        container.webkitRequestFullscreen();
                    }
                    canvas.classList.add('fullscreen');
                    document.body.classList.add('vr-mode');
                    this.isFullscreen = true;
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    }
                    canvas.classList.remove('fullscreen');
                    document.body.classList.remove('vr-mode');
                    this.isFullscreen = false;
                }
                
                this.updateRendererSize();
            }
            
            resetView() {
                this.camera.position.set(0, 0, 0);
                this.camera.lookAt(0, 0, -1);
            }
            
            toggleInstructions() {
                const instructions = document.querySelector('.instructions');
                instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
            }
            
            showLoading(show) {
                document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
            }
            
            updateRendererSize() {
                const canvas = document.getElementById('viewer-canvas');
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                
                this.renderer.setSize(width, height, false);
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
            }
            
            handleResize() {
                this.updateRendererSize();
                this.clearHotspots();
                setTimeout(() => this.createHotspots(), 100);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (this.autoRotate) {
                    this.sphere.rotation.y += 0.002;
                }
                
                this.renderer.render(this.scene, this.camera);
            }
            
            applyConfiguration() {
                try {
                    if (window.CONFIG) {
                        document.title = `${window.CONFIG.companyName} - 360° Virtual Tours`;
                    }
                } catch (error) {
                    console.warn('⚠️ Configuration application failed:', error);
                }
            }
        }

        // Global functions
        function requestSimilarProject(projectId) {
            const project = virtualTourProjects.find(p => p.id === projectId);
            console.log('🎯 Quote requested for similar project:', project.title);
            alert(`Thank you for your interest in a ${project.title} project! We'll contact you within 24 hours with a custom estimate based on your specific space and requirements.`);
        }

        // Initialize tour viewer
        let tourViewer;
        document.addEventListener('DOMContentLoaded', function() {
            tourViewer = new VirtualTourViewer();
            console.log('✅ 360° Virtual Tour Viewer initialized successfully');
        });

        // Handle fullscreen change
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                tourViewer.isFullscreen = false;
                document.getElementById('viewer-canvas').classList.remove('fullscreen');
                document.body.classList.remove('vr-mode');
                tourViewer.updateRendererSize();
            }
        });
    </script>
</body>
</html>